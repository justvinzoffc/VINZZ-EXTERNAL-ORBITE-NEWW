<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login - Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{
  margin:0;min-height:100vh;
  background:linear-gradient(#0d0d0d,#330000);
  display:flex;align-items:center;justify-content:center;
  color:white
}
.card{
  width:90%;max-width:360px;padding:30px;
  text-align:center;
  animation:fadeIn .8s ease
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1}
}
.logo{
  width:100px;height:100px;border-radius:20px;
  border:2px solid red;
  box-shadow:0 0 20px rgba(255,0,0,.5);
  margin:auto;overflow:hidden
}
.logo img{width:100%;height:100%;object-fit:cover}
h2{margin:20px 0 5px}
p{color:#aaa;font-size:14px}

.input{
  margin-top:15px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,0,0,.3);
  border-radius:12px;
  padding:14px;color:white;width:100%
}
.input:focus{outline:none;border-color:red}

.btn{
  margin-top:25px;width:100%;height:48px;
  border:none;border-radius:12px;
  background:red;color:white;
  font-weight:bold;cursor:pointer;
  box-shadow:0 5px 15px rgba(255,0,0,.5)
}
.btn.loading{
  pointer-events:none;
  background:#aa0000
}
.btn.loading::after{
  content:'';
  width:20px;height:20px;
  border:2px solid white;
  border-top-color:transparent;
  border-radius:50%;
  display:inline-block;
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

.popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center
}
.popup-box{
  background:#12002c;
  padding:20px;
  border-radius:16px;
  width:85%;max-width:320px;
  text-align:center
}
.popup h3{margin-top:0}
.popup button{
  margin-top:15px;
  background:none;
  border:none;
  color:#ff5555;
  cursor:pointer
}
</style>
</head>

<body>

<div class="card">
  <div class="logo">
    <img src="https://files.catbox.moe/x6243j.jpg">
  </div>

  <h2>Welcome Back</h2>
  <p>Sign in to continue</p>

  <input id="username" class="input" placeholder="Username">
  <input id="password" class="input" placeholder="Password" type="password">

  <button id="loginBtn" class="btn" onclick="login()">Sign In</button>
</div>

<!-- POPUP -->
<div id="popup" class="popup">
  <div class="popup-box">
    <h3 id="popupTitle"></h3>
    <p id="popupMsg"></p>
    <button onclick="closePopup()">Close</button>
    <button id="contactBtn" onclick="contactAdmin()" style="display:none">
      Contact Admin
    </button>
  </div>
</div>

<script>
const githubDB =
"https://raw.githubusercontent.com/justvinzoffc/APK-BUG-VINZZ-EXTERNALL/main/keys.json";

// Popup
function showPopup(title,msg,contact=false){
  popup.style.display="flex";
  popupTitle.innerText=title;
  popupMsg.innerText=msg;
  contactBtn.style.display=contact?"block":"none";
}
function closePopup(){popup.style.display="none"}
function contactAdmin(){
  window.open("https://t.me/vinzzloww","_blank");
}

// LOGIN
async function login(){
  const user=username.value.trim();
  const pass=password.value.trim();
  const btn=document.getElementById("loginBtn");

  if(!user || !pass){
    return showPopup("‚ö† Error","Isi semua data!");
  }

  btn.classList.add("loading");
  btn.innerHTML="";

  try{
    const res = await fetch(githubDB+"?cache="+Date.now());
    const db  = await res.json();

    /* ===== MAINTENANCE ===== */
    if(db.maintenance === true){
      btn.classList.remove("loading");
      btn.innerHTML="Sign In";
      return showPopup(
        "üõ† Maintenance",
        "Server sedang maintenance.\nSilakan coba lagi nanti.",
        true
      );
    }
    /* ====================== */

    const acc = db.users.find(
      u => u.username===user && u.password===pass
    );

    if(!acc){
      btn.classList.remove("loading");
      btn.innerHTML="Sign In";
      return showPopup(
        "‚ùå Login Failed",
        "Username atau password salah"
      );
    }

    // Cek expired
    if(acc.expired && acc.expired!=="Never"){
      const now=new Date();
      const exp=new Date(acc.expired);
      if(now>exp){
        btn.classList.remove("loading");
        btn.innerHTML="Sign In";
        return showPopup(
          "‚è≥ Access Expired",
          "Buy Acces To Owner",
          true
        );
      }
    }

    // Save session (AMAN)
    localStorage.setItem("username",acc.username);
    localStorage.setItem("role",acc.role);
    localStorage.setItem("loginTime",Date.now());

    location.href="dashboard.html";
  }
  catch(e){
    showPopup(
      "üö´ Error",
      "Error Saat Check In Database"
    );
  }

  btn.classList.remove("loading");
  btn.innerHTML="Sign In";
}
</script>

</body>
</html>